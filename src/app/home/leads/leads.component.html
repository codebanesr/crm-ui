<ion-content>
  <SearchBar [(ngModel)]="leadOptions.searchTerm" [placeholder]="'Search'" [maxLength]="8" (change)="handleSearchTerm()">
  </SearchBar>
  
  <!-- <nz-collapse [nzBordered]="true" *ngIf="leads" class="scrollable">
    <nz-collapse-panel [nzShowArrow]="false" *ngFor="let lead of leads" [nzHeader]="accordianheader"
      [nzActive]="lead.active" (contextmenu)="contextMenu($event, menu)">
      <ion-button (click)="handleLeadEdit(lead)">Edit</ion-button>
      <p *ngFor="let key of objectkeys(lead)">
        {{typeDict[key]?.label}} : {{typeDict[key]?.type === 'date' ? (lead[key] | date) : (lead[key])}}
      </p>
  
      <ng-template #accordianheader>
        <div nz-row nzJustify="space-between">
          <div nz-col nzFlex="6">
            <ion-label>
              <h3>{{lead?.firstName}}</h3>
              <h5>{{lead?.externalId}}</h5>
            </ion-label>
          </div>
          <div nz-col nzFlex="1">
            <ion-label (click)="$event.stopPropagation()">
              <i nz-icon nzType="mail" nzTheme="outline"></i> &nbsp;
              <ion-icon name="share-social-sharp" (click)="onSocialShareClick($event, lead)"></ion-icon>
            </ion-label>
          </div>
        </div>
      </ng-template>
  
  
      <nz-dropdown-menu #menu="nzDropdownMenu" class="context-area">
        <ul nz-menu>
          <li nz-menu-item (click)="openReassignModal(lead)">Reassign</li>
          <li nz-menu-item (click)="openReassignModal(lead, true)">Bulk Reassign</li>
          <li nz-menu-item (click)="showLeadHistory(lead)">Show history</li>
          <li nz-menu-item nzDisabled>disabled menu item</li>
          <li nz-submenu nzTitle="Email/Message">
            <ul>
              <li nz-menu-item (click)="showEmailModal(lead)">Send Email</li>
              <li nz-menu-item>4th menu item</li>
            </ul>
          </li>
          <li nz-submenu nzTitle="Move To">
            <ul>
              <li nz-menu-item>Created</li>
              <li nz-menu-item>Won</li>
              <li nz-menu-item>Lost</li>
            </ul>
          </li>
          <li nz-menu-item (click)="showFilterDrawer = true">Advanced Filters</li>
        </ul>
      </nz-dropdown-menu>
  
    </nz-collapse-panel>
  </nz-collapse> -->
  
  
  <mat-accordion style="overflow-y: scroll;">
    <mat-expansion-panel (opened)="lead.panelOpenState = true" (closed)="lead.panelOpenState = false"
      *ngFor="let lead of leads" hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{lead?.firstName}} {{lead?.lastName}}
        </mat-panel-title>
        <mat-panel-description style="text-align: end;">
  
        </mat-panel-description>
      </mat-expansion-panel-header>
      <button mat-raised-button color="primary" (click)="handleLeadEdit(lead)" class="lead-edit-btn">Edit Lead</button>
      <i nz-icon nzType="mail" nzTheme="outline" style="font-size: large;"></i> &nbsp;
      <ion-icon name="share-social-sharp" (click)="onSocialShareClick($event, lead)" style="font-size: large;"></ion-icon>
  
      
        <p *ngFor="let key of objectkeys(lead)">
          <ng-container *ngIf="typeDict && typeDict[key]?.value">
            {{typeDict[key]?.label}} : {{typeDict[key]?.type === 'date' ? (lead[key] | date) : (lead[key])}}
          </ng-container>
        </p>
      
    </mat-expansion-panel>
    <mat-paginator [length]="total"
                (page)="onQueryParamsChange($event)"
                [pageSize]="perPage"
                [pageSizeOptions]="[5, 10, 25, 100]">
    </mat-paginator>
  </mat-accordion>
  
  <!-- <mat-paginator class="pagination-component" [length]="total" [(pageSize)]="perPage" (page)="onQueryParamsChange($event)"></mat-paginator> -->
  <nz-empty *ngIf="isEmpty"></nz-empty>
  
  
  <nz-drawer [nzClosable]="true" [nzVisible]="showFilterDrawer" [nzPlacement]="'right'" nzTitle="Lead Filters"
    (nzOnClose)="closeFilterDrawer()">
  
    <nz-select nzMode="default" [nzPlaceHolder]="'select campaign'" [(ngModel)]="selectedCampaign"
      (ngModelChange)="onCampaignSelect()" style="width: 200px;">
      <nz-option *ngFor="let campaign of campaignList" [nzLabel]="campaign.campaignName" [nzValue]="campaign">
      </nz-option>
    </nz-select>
  

    <mat-card>
      <nz-tree [nzData]="callDispositions" (nzClick)="handleDispositionTreeEvent($event)">
      </nz-tree>
    </mat-card>


    <nz-collapse [nzBordered]="false">
      <nz-collapse-panel [nzHeader]="'Lead Filter'" [nzActive]="false">
        <ng-container *ngIf="typeDict">
          <ng-container *ngFor="let key of objectkeys(typeDict)">
            <nz-descriptions nzLayout="vertical">
              <nz-descriptions-item *ngIf="typeDict[key]" [nzTitle]="typeDict[key].label">
                <ng-container [ngSwitch]="typeDict[key].type">
                  <ng-container *ngSwitchCase="'date'">
                    <input type="datetime-local" nz-input [(ngModel)]="leadOptions.filters[key]"
                      [ngModelOptions]="{standalone: true}">
                  </ng-container>
  
                  <ng-container *ngSwitchCase="'number'">
                    <input nz-input placeholder="Basic usage" [(ngModel)]="leadOptions.filters[key]"
                      [ngModelOptions]="{standalone: true}" />
                  </ng-container>
  
                  <ng-container *ngSwitchCase="'string'">
                    <input nz-input placeholder="Basic usage" [(ngModel)]="leadOptions.filters[key]"
                      [ngModelOptions]="{standalone: true}" />
                  </ng-container>
  
                  <ng-container *ngSwitchCase="'tel'">
                    <input nz-input [(ngModel)]="leadOptions.filters[key]" [ngModelOptions]="{standalone: true}" />
                  </ng-container>
  
                  <ng-container *ngSwitchCase="'select'">
                    <nz-select nzMode="default" [(ngModel)]="leadOptions.filters[key]"
                      [ngModelOptions]="{standalone: true}">
                      <nz-option *ngFor="let option of typeDict[key].options" [nzLabel]="option" [nzValue]="option">
                      </nz-option>
                    </nz-select>
                  </ng-container>
                </ng-container>
              </nz-descriptions-item>
            </nz-descriptions>
          </ng-container>
          <!-- <button nz-button (click)="printFilters()">print filters</button> -->
          <ion-button expand="block" (click)="getData()">Submit</ion-button>
        </ng-container>
      </nz-collapse-panel>
    </nz-collapse>
  </nz-drawer>
  
  
  <!-- form will adjust according to the modal size so let everything be at 24 grid size -->
  <nz-modal [(nzVisible)]="isVisible" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <form nz-form [formGroup]="emailForm" nzLayout="vertical">
      <nz-form-item>
        <nz-form-label [nzSm]="24" [nzXs]="24" nzRequired>Search By Email Subject</nz-form-label>
        <input placeholder="Email Subject" nz-input [formControl]="etFormControl" [nzAutocomplete]="autob" />
        <nz-autocomplete #autob (selectionChange)="populateEmailModal($event)">
          <nz-auto-option *ngFor="let et of emailTemplates" [nzValue]="et" [nzLabel]="et.subject">
            {{ et.subject }}
          </nz-auto-option>
        </nz-autocomplete>
      </nz-form-item>
  
      <nz-form-item>
        <nz-form-label [nzSm]="24" [nzXs]="24" nzRequired>Subject</nz-form-label>
        <nz-form-control [nzSm]="24" [nzXs]="24">
          <input nz-input placeholder="Write the subject of email" formControlName="subject" />
        </nz-form-control>
      </nz-form-item>
  
      <nz-form-item>
        <nz-form-label [nzSm]="24" [nzXs]="24" nzRequired>Body</nz-form-label>
        <nz-form-control [nzSm]="24" [nzXs]="24">
          <textarea nz-input placeholder="Controlled autosize" [nzAutosize]="{ minRows: 3, maxRows: 5 }"
            formControlName="content"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="24" [nzXs]="24" nzRequired>Attachments</nz-form-label>
        <nz-form-control [nzSm]="24" [nzXs]="24">
          <nz-select [nzMaxTagCount]="3" [nzMaxTagPlaceholder]="tagPlaceHolder" nzMode="multiple"
            nzPlaceHolder="Please select attachments from the dropdown" formControlName="attachments">
            <nz-option *ngFor="let attachment of attachments" [nzLabel]="attachment.fileName" [nzValue]="attachment">
            </nz-option>
          </nz-select>
          <ng-template #tagPlaceHolder let-selectedList> and {{ selectedList.length }} more selected </ng-template>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-modal>
  
  
  <!-- reassignment modal -->
  <nz-modal [nzStyle]="{ top: '20px' }" [(nzVisible)]="isReassignmentModalVisible" nzWidth="300"
    (nzOnCancel)="handleReassignmentCancel()" nzTitle="Pick a user" *ngIf="managers">
    <input nz-input placeholder="Enter user name" nzSize="small" [formControl]="selectedManager" name="selectedManager" />
  
    <nz-list nzItemLayout="horizontal">
      <nz-list-item *ngFor="let manager of managers" (click)="reassignLead(manager)">
        <nz-list-item-meta [nzDescription]="manager.email">
        </nz-list-item-meta>
      </nz-list-item>
      <nz-list-empty *ngIf="!managers || managers.length === 0"></nz-list-empty>
    </nz-list>
    <div *nzModalFooter></div>
  </nz-modal>
  
  
  
  <!-- timeline modal-->
  <nz-modal [(nzVisible)]="isTimelineModalVisible" (nzOnCancel)="handleTimelineClose()"
    nzTitle="History for Lead {{selectedLead?.externalId}}" *ngIf="campaignList">
    <nz-timeline *ngIf="selectedLeadHistory?.history?.length > 0; else empty">
      <nz-timeline-item *ngFor="let element of selectedLeadHistory?.history">
        {{element.note}}
      </nz-timeline-item>
    </nz-timeline>
  </nz-modal>
  
  <ng-template #dotTemplate>
    <i nz-icon nzType="clock-circle-o" style="font-size: 16px;"></i>
  </ng-template>
  
  <ng-template #empty>
    <nz-empty></nz-empty>
  </ng-template>
  
  
  <ion-fab horizontal="end" vertical="bottom" slot="fixed" style="position: absolute; bottom: 70px;">
    <ion-fab-button>
      <ion-icon md="caret-up" ios="chevron-up-circle-outline"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <!-- create lead -->
      <ion-fab-button color="primary" (click)="handleCreateLead()">
        <!-- filter -->
        <ion-icon name="add-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="primary">
        <!-- followup -->
        <ion-icon name="alarm-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="primary" (click)="showFilterDrawer = true">
        <ion-icon name="filter"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
