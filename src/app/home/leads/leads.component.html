<ion-content>
  <ion-searchbar placeholder="Filter Leads" (change)="handleSearchTerm()" showCancelButton="focus"
    [(ngModel)]="leadOptions.searchTerm"></ion-searchbar>
  <mat-accordion style="overflow-y: scroll;" *ngIf="!isEmpty">
    <mat-expansion-panel (opened)="lead.panelOpenState = true" (closed)="lead.panelOpenState = false"
      *ngFor="let lead of leads; trackBy: trackLead" hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title style="width: 100%;">
          <span>{{lead?.firstName}} {{lead?.lastName}}</span>
          <span class="spacer"></span>

          <span style="font-weight: 500; color: #673ab7;">{{lead.leadStatus | titlecase}}</span>

        </mat-panel-title>
      </mat-expansion-panel-header>
      <button mat-raised-button color="primary" (click)="handleLeadEdit(lead)" class="lead-edit-btn">Edit Lead</button>
      <i nz-icon nzType="mail" nzTheme="outline" style="font-size: large;"></i> &nbsp;
      <ion-icon name="share-social-sharp" (click)="onSocialShareClick($event, lead)" style="font-size: large;">
      </ion-icon>


      <!-- @Todo do not show mobile numbers in show view, also prevent fetching mobile numbers -->
      <p *ngFor="let key of objectkeys(lead); trackBy: trackKeys">
        <ng-container *ngIf="typeDict && typeDict[key]?.value && typeDict[key].type !=='tel'">
          {{typeDict[key]?.label}} : {{typeDict[key]?.type === 'date' ? (lead[key] | date) : (lead[key])}}
        </ng-container>
      </p>

    </mat-expansion-panel>
    <mat-paginator [length]="total" (page)="onQueryParamsChange($event)" [pageSize]="perPage"
      [pageSizeOptions]="[5, 10, 25, 100]">
    </mat-paginator>
  </mat-accordion>

  <!-- <mat-paginator class="pagination-component" [length]="total" [(pageSize)]="perPage" (page)="onQueryParamsChange($event)"></mat-paginator> -->
  <nz-empty *ngIf="isEmpty"></nz-empty>


  <nz-drawer [nzClosable]="true" [nzVisible]="showFilterDrawer" [nzPlacement]="'right'" nzTitle="Lead Filters"
    (nzOnClose)="closeFilterDrawer()">

    <mat-select nzMode="default" [(ngModel)]="selectedCampaign" (ngModelChange)="onCampaignSelect()"
      style="width: 200px;">
      <mat-option [value]='{_id: "all"}'>All Campaign</mat-option>
      <mat-option *ngFor="let campaign of campaignList" [value]="campaign">{{campaign.campaignName}}</mat-option>
    </mat-select>


    <mat-accordion>
      <mat-expansion-panel *ngIf="typeDict">
        <mat-expansion-panel-header>
          Lead Filter
        </mat-expansion-panel-header>

        <ng-container *ngFor="let key of objectkeys(typeDict)">
          <!-- <nz-descriptions-item *ngIf="typeDict[key]" [nzTitle]="typeDict[key].label"> -->
          <mat-form-field *ngIf="typeDict[key].value && typeDict[key].label" class="mat-full-width"
            appearance="outline">
            <mat-label>{{typeDict[key].label}}</mat-label>
            <ng-container [ngSwitch]="typeDict[key].type">
              <ng-container *ngSwitchCase="'date'">
                <input matInput type="datetime-local" matInput [(ngModel)]="leadOptions.filters[key]"
                  [ngModelOptions]="{standalone: true}">
              </ng-container>

              <ng-container *ngSwitchCase="'number'">
                <input matInput placeholder="Basic usage" [(ngModel)]="leadOptions.filters[key]"
                  [ngModelOptions]="{standalone: true}" />
              </ng-container>

              <ng-container *ngSwitchCase="'string'">
                <input matInput placeholder="Basic usage" [(ngModel)]="leadOptions.filters[key]"
                  [ngModelOptions]="{standalone: true}" />
              </ng-container>

              <ng-container *ngSwitchCase="'tel'">
                <input matInput [(ngModel)]="leadOptions.filters[key]" [ngModelOptions]="{standalone: true}" />
              </ng-container>

              <ng-container *ngSwitchCase="'geo'">
                <input matInput [(ngModel)]="leadOptions.filters[key]" [ngModelOptions]="{standalone: true}" />
              </ng-container>

              <ng-container *ngSwitchCase="'select'">
                <mat-select [(ngModel)]="leadOptions.filters[key]" [ngModelOptions]="{standalone: true}">
                  <mat-option *ngFor="let option of typeDict[key].options" [value]="option">{{option}}</mat-option>
                </mat-select>
              </ng-container>
            </ng-container>
          </mat-form-field>

        </ng-container>
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>
            Disposition Filter
          </mat-panel-title>
        </mat-expansion-panel-header>
        <!-- <mat-chip color="accent" selected>{{leadOptions.filters["dispositionFilter"]}}</mat-chip> -->
        <nz-tree nzMultiple [nzData]="callDispositions" (nzClick)="nodeClickEvent($event)"
          [nzSelectedKeys]="selectedKeys" class="pull-left"></nz-tree>
      </mat-expansion-panel>
    </mat-accordion>
    <button mat-raised-button color="primary" (click)="getData()" class="mat-full-width"
      style="margin-top: 4px;">Submit</button>
  </nz-drawer>



  <ng-template #empty>
    <nz-empty></nz-empty>
  </ng-template>


  <ion-fab horizontal="end" vertical="bottom" slot="fixed" style="position: absolute; bottom: 70px;">
    <ion-fab-button>
      <ion-icon md="caret-up" ios="chevron-up-circle-outline"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <!-- create lead -->
      <ion-fab-button color="primary" (click)="handleCreateLead()">
        <!-- filter -->
        <ion-icon name="add-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="primary">
        <!-- followup -->
        <ion-icon name="alarm-outline"></ion-icon>
      </ion-fab-button>
      <ion-fab-button color="primary" (click)="showFilterDrawer = true">
        <ion-icon name="filter"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>